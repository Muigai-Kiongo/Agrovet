{% extends "base.html" %}
{% load humanize %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
    <h1 class="h2 text-dark"><i class="fas fa-tachometer-alt text-success me-2"></i>Dashboard Summary</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{% url 'inventory:purchase_add' %}" class="btn btn-sm btn-outline-primary shadow-sm">
                <i class="fas fa-truck-loading me-1"></i> General Restock
            </a>
            <a href="{% url 'inventory:admin_report' %}" class="btn btn-sm btn-outline-dark">
                <i class="fas fa-file-alt me-1"></i> Full Report
            </a>
            <a href="{% url 'inventory:sale_add' %}" class="btn btn-sm btn-success px-3 shadow-sm">
                <i class="fas fa-cash-register me-1"></i> New POS Sale
            </a>
        </div>
    </div>
</div>

<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100 bg-success text-white">
            <div class="card-body text-center">
                <h6 class="text-uppercase mb-2 opacity-75">Today's Revenue</h6>
                <h2 class="display-6 fw-bold">KES {{ todays_sales|intcomma }}</h2>
                <small class="opacity-75">Total sales for {% now "D, d M Y" %}</small>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100 bg-white border-start border-warning border-4">
            <div class="card-body text-center">
                <h6 class="text-uppercase mb-2 text-muted small fw-bold">Pending Orders</h6>
                <h2 class="display-6 fw-bold text-warning">{{ pending_orders }}</h2>
                <a href="{% url 'inventory:order_list' %}" class="btn btn-sm btn-link text-warning text-decoration-none p-0">View Online Orders</a>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100 bg-white border-start border-primary border-4">
            <div class="card-body text-center">
                <h6 class="text-uppercase mb-2 text-muted small fw-bold">Active Inventory</h6>
                <h2 class="display-6 fw-bold text-primary">{{ products_count|intcomma }}</h2>
                <p class="text-muted small mb-0">Total Product SKUs</p>
                <a href="{% url 'inventory:product_list' %}" class="stretched-link"></a>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card border-0 shadow-sm h-100 bg-white border-start border-danger border-4">
            <div class="card-body text-center">
                <h6 class="text-uppercase mb-2 text-muted small fw-bold">Restock Required</h6>
                <h2 class="display-6 fw-bold text-danger">{{ low_stock_products|length }}</h2>
                <p class="text-muted small mb-0">Items below reorder level</p>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-8">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold text-danger"><i class="fas fa-exclamation-circle me-2"></i>Low Stock Inventory</h5>
                {% if low_stock_products %}
                <span class="badge bg-danger-subtle text-danger border border-danger px-3">Attention Needed</span>
                {% endif %}
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light small text-uppercase">
                            <tr>
                                <th class="ps-4">Product</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Threshold</th>
                                <th class="text-end pe-4">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in low_stock_products %}
                            <tr>
                                <td class="ps-4">
                                    <div class="fw-bold">{{ product.name }}</div>
                                    <small class="text-muted">SKU: {{ product.sku }}</small>
                                </td>
                                <td>{{ product.category.name|default:"General" }}</td>
                                <td>
                                    <span class="badge {% if product.stock_quantity <= 0 %}bg-danger{% else %}bg-warning text-dark{% endif %}">
                                        {{ product.stock_quantity|floatformat:0 }} {{ product.unit.name|default:"units" }}
                                    </span>
                                </td>
                                <td class="text-muted small">{{ product.reorder_level|floatformat:0 }}</td>
                                <td class="text-end pe-4">
                                    <a href="{% url 'inventory:purchase_add' %}?product_id={{ product.id }}" class="btn btn-sm btn-outline-success">
                                        <i class="fas fa-plus me-1"></i> Restock
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-5 text-success">
                                    <i class="fas fa-check-circle fa-2x mb-2 d-block"></i>
                                    All inventory levels are healthy!
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% if low_stock_products %}
            <div class="card-footer bg-white py-3 border-top">
                <a href="{% url 'inventory:purchase_add' %}" class="btn btn-sm btn-primary w-100">
                    <i class="fas fa-shopping-cart me-2"></i> Open Bulk Purchase Form
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3"><h6 class="mb-0 fw-bold">System Configuration</h6></div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush small">
                    <a href="{% url 'inventory:category_list' %}" class="list-group-item list-group-item-action py-3 d-flex justify-content-between align-items-center">
                        <div><i class="fas fa-tags text-secondary me-2"></i> Categories</div>
                        <span class="badge bg-light text-dark rounded-pill">{{ categories_count }}</span>
                    </a>
                    <a href="{% url 'inventory:unit_list' %}" class="list-group-item list-group-item-action py-3">
                        <i class="fas fa-balance-scale text-secondary me-2"></i> Measurement Units
                    </a>
                    <a href="{% url 'inventory:stock_history' %}" class="list-group-item list-group-item-action py-3">
                        <i class="fas fa-history text-secondary me-2"></i> Stock Audit Logs
                    </a>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3"><h6 class="mb-0 fw-bold">People & Suppliers</h6></div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush small">
                    <a href="{% url 'inventory:supplier_list' %}" class="list-group-item list-group-item-action py-3">
                        <i class="fas fa-truck text-secondary me-2"></i> Manage Suppliers
                    </a>
                    <a href="{% url 'inventory:customer_list' %}" class="list-group-item list-group-item-action py-3">
                        <i class="fas fa-users text-secondary me-2"></i> Customer Database
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}